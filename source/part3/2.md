## 微信公众号登录流程的设计



- 对公众号后台而言，用户只要关注了公众号，就有一个唯一的openid. 玩家时刻在线的。
- 但对Niubility用户而言，它需要登录第三方平台，获取授权。那如何完成？

### 查看douban api , 研究如何以授权的方式登录

在豆瓣申请一个api应用，豆瓣会根据app的ID和key生成一个专属应用的授权页面。

用户填入授权信息后，会回调到一个应用预留的页面。

如果成功，用户会得到一个accesstoken.

然后可以使用这个accesstoken去访问授权数据。

### 登录方式的设计

在微信的聊天窗口内与玩家交互的时候，玩家点击链接授权完成后，公众号该如何得知玩家已经授权成功？

这里要用到豆瓣api预留了一个state字段。
玩家点击链接的时候，传入自己的公众号id，授权回调以后，根据公众号id创建或者找到角色数据，更新token.

这样将授权的动作和玩家的公众号数据关联起来了。

